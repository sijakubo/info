{"componentChunkName":"component---src-templates-blog-post-js","path":"/notes/testcontainers-spock-spring","result":{"data":{"markdownRemark":{"html":"<p>A great way to include all the required resources for integration tests, <a href=\"https://www.testcontainers.org/\">Testcontainers</a> provides an easy way to start docker containers from within your testcode. This removes the necessity to create test <code class=\"language-text\">docker-compose.yml</code> files and write <code class=\"language-text\">README.md</code> code on how to even run a test.</p>\n<p>Here is a short example using testcontainers with Spring and Spock on a Postgis / Postgres database.</p>\n<div class=\"gatsby-highlight\" data-language=\"groovy\"><pre class=\"language-groovy\"><code class=\"language-groovy\"><span class=\"token annotation punctuation\">@SpringBootTest</span>\n<span class=\"token annotation punctuation\">@AutoConfigureMockMvc</span>\n<span class=\"token annotation punctuation\">@AutoConfigureTestDatabase</span><span class=\"token punctuation\">(</span>replace <span class=\"token operator\">=</span> AutoConfigureTestDatabase<span class=\"token punctuation\">.</span>Replace<span class=\"token punctuation\">.</span>NONE<span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@ContextConfiguration</span><span class=\"token punctuation\">(</span>initializers <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>Initializer<span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">FieldControllerTest</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">IntegrationTest</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token annotation punctuation\">@Shared</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> JdbcDatabaseContainer postgreSQLContainer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PostgisContainerProvider</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">newInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">withDatabaseName</span><span class=\"token punctuation\">(</span><span class=\"token interpolation-string\"><span class=\"token string\">\"integration-tests-db\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">withUsername</span><span class=\"token punctuation\">(</span><span class=\"token interpolation-string\"><span class=\"token string\">\"sa\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">withPassword</span><span class=\"token punctuation\">(</span><span class=\"token interpolation-string\"><span class=\"token string\">\"sa\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n  <span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Initializer</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">ApplicationContextInitializer</span><span class=\"token operator\">&lt;</span>ConfigurableApplicationContext<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">void</span> <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span>ConfigurableApplicationContext configurableApplicationContext<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      postgreSQLContainer<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      TestPropertyValues<span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span>\n        <span class=\"token interpolation-string\"><span class=\"token string\">\"spring.datasource.url=\"</span></span> <span class=\"token operator\">+</span> postgreSQLContainer<span class=\"token punctuation\">.</span><span class=\"token function\">getJdbcUrl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token interpolation-string\"><span class=\"token string\">\"spring.datasource.username=\"</span></span> <span class=\"token operator\">+</span> postgreSQLContainer<span class=\"token punctuation\">.</span><span class=\"token function\">getUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token interpolation-string\"><span class=\"token string\">\"spring.datasource.password=\"</span></span> <span class=\"token operator\">+</span> postgreSQLContainer<span class=\"token punctuation\">.</span><span class=\"token function\">getPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">applyTo</span><span class=\"token punctuation\">(</span>configurableApplicationContext<span class=\"token punctuation\">.</span><span class=\"token function\">getEnvironment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token annotation punctuation\">@Autowired</span>\n  MockMvc mockMvc\n\n  <span class=\"token annotation punctuation\">@Autowired</span>\n  FieldRepository fieldRepository\n\n  <span class=\"token keyword\">void</span> <span class=\"token function\">setup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    fieldRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Field</span><span class=\"token punctuation\">(</span>\n      UUID<span class=\"token punctuation\">.</span><span class=\"token function\">fromString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ad68f894-c16b-4953-b577-7cddb3e85ae5'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token interpolation-string\"><span class=\"token string\">\"initSampleField\"</span></span><span class=\"token punctuation\">,</span>\n      <span class=\"token keyword\">new</span> <span class=\"token class-name\">Polygon</span><span class=\"token punctuation\">(</span>\n        PositionSequenceBuilders<span class=\"token punctuation\">.</span><span class=\"token function\">variableSized</span><span class=\"token punctuation\">(</span>G2D<span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">5.8208837124389</span><span class=\"token punctuation\">,</span> <span class=\"token number\">51.0596004663904</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">5.83490292265498</span><span class=\"token punctuation\">,</span> <span class=\"token number\">51.0571257015788</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">5.87078646658134</span><span class=\"token punctuation\">,</span> <span class=\"token number\">51.0451607414904</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">5.79146302423308</span><span class=\"token punctuation\">,</span> <span class=\"token number\">51.0612386272784</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">5.8208837124389</span><span class=\"token punctuation\">,</span> <span class=\"token number\">51.0596004663904</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">toPositionSequence</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        CoordinateReferenceSystems<span class=\"token punctuation\">.</span>WGS84\n      <span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token punctuation\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>To integrate testcontainers into your project, you'll need the following dependencies:</p>\n<p>gradle:</p>\n<div class=\"gatsby-highlight\" data-language=\"groovy\"><pre class=\"language-groovy\"><code class=\"language-groovy\">dependencyManagement <span class=\"token punctuation\">{</span>\n  imports <span class=\"token punctuation\">{</span>\n    mavenBom <span class=\"token interpolation-string\"><span class=\"token string\">\"org.testcontainers:testcontainers-bom:</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token expression\">testcontainersVersion</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"</span></span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\ndependencies <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">...</span>\n\n  testImplementation <span class=\"token interpolation-string\"><span class=\"token string\">\"org.testcontainers:spock:1.17.5\"</span></span>\n  testImplementation <span class=\"token interpolation-string\"><span class=\"token string\">\"org.testcontainers:postgresql:1.17.5\"</span></span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Happy testing ðŸŽ‰</p>","excerpt":"A great way to include all the required resources for integration tests, Testcontainers provides an easy way to start docker containers from within yourâ€¦","frontmatter":{"date":"18 October, 2022","path":"/notes/testcontainers-spock-spring","title":"Testcontainers | Postgres: Postgis with Spring and Spock"},"timeToRead":1}},"pageContext":{}},"staticQueryHashes":["3649515864","63159454"],"slicesMap":{}}